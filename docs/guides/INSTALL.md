# 安装和配置指南

## 快速开始

### 1. 安装插件

#### 开发者模式安装（推荐）
1. 下载项目文件到本地文件夹
2. 打开Chrome浏览器
3. 访问 `chrome://extensions/`
4. 开启右上角的"开发者模式"开关
5. 点击"加载已解压的扩展程序"
6. 选择项目文件夹
7. 插件安装完成，会在工具栏显示🛡️图标

### 2. 基础配置

#### 配置LLM API
1. 右键点击插件图标，选择"选项"
2. 在LLM配置区域填写：
   - **API端点**: 根据你的LLM提供商填写
   - **API密钥**: 你的API密钥
   - **模型**: 支持多模态的模型名称

#### 常用LLM配置示例

**OpenAI GPT-4**
```
端点: https://api.openai.com/v1/chat/completions
模型: gpt-4-vision-preview
密钥: sk-your-openai-api-key
```

**Azure OpenAI**
```
端点: https://your-resource.openai.azure.com/openai/deployments/your-deployment/chat/completions?api-version=2023-12-01-preview
模型: gpt-4-vision-preview
密钥: your-azure-api-key
```

**Anthropic Claude**
```
端点: https://api.anthropic.com/v1/messages
模型: claude-3-opus-20240229
密钥: your-anthropic-api-key
```

### 3. 测试配置
1. 在配置页面点击"🧪 测试配置"按钮
2. 确认显示"配置测试成功"
3. 点击"💾 保存配置"

## 使用方法

### 基本使用流程

1. **打开需求页面**
   - 在PingCode或其他需求管理平台打开产品需求页面
   - 确保页面完全加载

2. **启动分析**
   - 点击浏览器工具栏的🛡️插件图标
   - 插件会自动检测页面内容

3. **选择分析源**
   - **附件优先**: 如果检测到PDF/DOCX附件，会自动选择
   - **页面文本**: 如果没有附件，会提取页面文本内容
   - **手动输入**: 可以手动粘贴需求内容

4. **开始分析**
   - 可选：修改分析提示词
   - 点击"🚀 开始分析"按钮
   - 等待LLM分析完成

5. **查看结果**
   - 分析结果会在新窗口中显示
   - 包含威胁识别、测试场景、安全建议等
   - 可以导出JSON格式或打印报告

### 高级功能

#### 自定义页面选择器
如果默认的页面检测不准确，可以添加自定义选择器：

1. 在配置页面找到"页面检测配置"
2. 添加CSS选择器，例如：
   ```css
   .custom-attachment-class
   [data-file="requirement"]
   .my-site-file-list a
   ```

#### 威胁建模平台集成
如果你有威胁建模平台，可以配置自动集成：

1. 填写平台地址和API密钥
2. 分析结果会自动发送到平台
3. 在平台中查看和管理威胁模型

## 故障排除

### 常见问题

**Q: 插件无法检测页面内容**
- 确保页面完全加载
- 检查页面是否有安全限制
- 尝试刷新页面后重新检测

**Q: LLM API调用失败**
- 检查API密钥是否正确
- 确认API端点地址正确
- 检查网络连接
- 验证API配额是否充足

**Q: 附件检测不准确**
- 添加自定义CSS选择器
- 检查附件链接是否可访问
- 尝试手动输入内容

**Q: 分析结果格式异常**
- 检查LLM模型是否支持结构化输出
- 尝试调整提示词
- 查看原始分析结果

### 调试模式

开启Chrome开发者工具查看详细日志：
1. 按F12打开开发者工具
2. 切换到Console标签
3. 重新执行操作
4. 查看错误信息和调试日志

## 安全注意事项

### 数据安全
- API密钥仅存储在本地Chrome存储中
- 不会上传完整的需求文档到外部服务
- 建议使用专用的API密钥，定期轮换

### 隐私保护
- 插件仅在用户主动触发时分析内容
- 不会自动收集或传输页面数据
- 分析结果仅在本地显示

### 最佳实践
- 定期更新插件到最新版本
- 不要在公共计算机上保存API配置
- 对敏感需求文档谨慎使用在线LLM服务

## 更新和维护

### 检查更新
- 定期查看项目GitHub页面
- 关注新功能和安全更新

### 备份配置
- 在配置页面导出配置
- 重装插件前备份设置

### 反馈问题
- 通过GitHub Issues报告问题
- 提供详细的错误信息和复现步骤

---

如有其他问题，请参考README.md或联系开发团队。